{"version":3,"file":"tracker.min.js","sources":["../node_modules/@babel/runtime/helpers/readOnlyError.js","../node_modules/@babel/runtime/helpers/classCallCheck.js","../node_modules/@babel/runtime/helpers/createClass.js","../node_modules/extend/index.js","../src/utils.js","../src/tracker.js","../src/index.js"],"sourcesContent":["function _readOnlyError(name) {\n  throw new TypeError(\"\\\"\" + name + \"\\\" is read-only\");\n}\n\nmodule.exports = _readOnlyError;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","'use strict';\n\nvar hasOwn = Object.prototype.hasOwnProperty;\nvar toStr = Object.prototype.toString;\nvar defineProperty = Object.defineProperty;\nvar gOPD = Object.getOwnPropertyDescriptor;\n\nvar isArray = function isArray(arr) {\n\tif (typeof Array.isArray === 'function') {\n\t\treturn Array.isArray(arr);\n\t}\n\n\treturn toStr.call(arr) === '[object Array]';\n};\n\nvar isPlainObject = function isPlainObject(obj) {\n\tif (!obj || toStr.call(obj) !== '[object Object]') {\n\t\treturn false;\n\t}\n\n\tvar hasOwnConstructor = hasOwn.call(obj, 'constructor');\n\tvar hasIsPrototypeOf = obj.constructor && obj.constructor.prototype && hasOwn.call(obj.constructor.prototype, 'isPrototypeOf');\n\t// Not own constructor property must be Object\n\tif (obj.constructor && !hasOwnConstructor && !hasIsPrototypeOf) {\n\t\treturn false;\n\t}\n\n\t// Own properties are enumerated firstly, so to speed up,\n\t// if last one is own, then all properties are own.\n\tvar key;\n\tfor (key in obj) { /**/ }\n\n\treturn typeof key === 'undefined' || hasOwn.call(obj, key);\n};\n\n// If name is '__proto__', and Object.defineProperty is available, define __proto__ as an own property on target\nvar setProperty = function setProperty(target, options) {\n\tif (defineProperty && options.name === '__proto__') {\n\t\tdefineProperty(target, options.name, {\n\t\t\tenumerable: true,\n\t\t\tconfigurable: true,\n\t\t\tvalue: options.newValue,\n\t\t\twritable: true\n\t\t});\n\t} else {\n\t\ttarget[options.name] = options.newValue;\n\t}\n};\n\n// Return undefined instead of __proto__ if '__proto__' is not an own property\nvar getProperty = function getProperty(obj, name) {\n\tif (name === '__proto__') {\n\t\tif (!hasOwn.call(obj, name)) {\n\t\t\treturn void 0;\n\t\t} else if (gOPD) {\n\t\t\t// In early versions of node, obj['__proto__'] is buggy when obj has\n\t\t\t// __proto__ as an own property. Object.getOwnPropertyDescriptor() works.\n\t\t\treturn gOPD(obj, name).value;\n\t\t}\n\t}\n\n\treturn obj[name];\n};\n\nmodule.exports = function extend() {\n\tvar options, name, src, copy, copyIsArray, clone;\n\tvar target = arguments[0];\n\tvar i = 1;\n\tvar length = arguments.length;\n\tvar deep = false;\n\n\t// Handle a deep copy situation\n\tif (typeof target === 'boolean') {\n\t\tdeep = target;\n\t\ttarget = arguments[1] || {};\n\t\t// skip the boolean and the target\n\t\ti = 2;\n\t}\n\tif (target == null || (typeof target !== 'object' && typeof target !== 'function')) {\n\t\ttarget = {};\n\t}\n\n\tfor (; i < length; ++i) {\n\t\toptions = arguments[i];\n\t\t// Only deal with non-null/undefined values\n\t\tif (options != null) {\n\t\t\t// Extend the base object\n\t\t\tfor (name in options) {\n\t\t\t\tsrc = getProperty(target, name);\n\t\t\t\tcopy = getProperty(options, name);\n\n\t\t\t\t// Prevent never-ending loop\n\t\t\t\tif (target !== copy) {\n\t\t\t\t\t// Recurse if we're merging plain objects or arrays\n\t\t\t\t\tif (deep && copy && (isPlainObject(copy) || (copyIsArray = isArray(copy)))) {\n\t\t\t\t\t\tif (copyIsArray) {\n\t\t\t\t\t\t\tcopyIsArray = false;\n\t\t\t\t\t\t\tclone = src && isArray(src) ? src : [];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tclone = src && isPlainObject(src) ? src : {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Never move original objects, clone them\n\t\t\t\t\t\tsetProperty(target, { name: name, newValue: extend(deep, clone, copy) });\n\n\t\t\t\t\t// Don't bring in undefined values\n\t\t\t\t\t} else if (typeof copy !== 'undefined') {\n\t\t\t\t\t\tsetProperty(target, { name: name, newValue: copy });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Return the modified object\n\treturn target;\n};\n","import extend from 'extend';\r\n\r\nexport const getEvent = (event) => {\r\n    event = event || window.event;\r\n    if (!event) {\r\n        return event;\r\n    }\r\n    if (!event.target) {\r\n        event.target = event.srcElement;\r\n    }\r\n    if (!event.currentTarget) {\r\n        event.currentTarget = event.srcElement;\r\n    }\r\n    return event;\r\n}\r\n\r\nexport const getEventListenerMethod = () => {\r\n    let addMethod = 'addEventListener', removeMethod = 'removeEventListener', prefix = '';\r\n    if (!window.addEventListener) {\r\n        addMethod = 'attachEvent';\r\n        removeMethod = 'detachEvent';\r\n        prefix = 'on';\r\n    }\r\n    return {\r\n        addMethod,\r\n        removeMethod,\r\n        prefix,\r\n    }\r\n}\r\n\r\nexport const getBoundingClientRect = (element) => {\r\n    const rect = element.getBoundingClientRect();\r\n    const width = rect.width || rect.right - rect.left;\r\n    const heigth = rect.heigth || rect.bottom - rect.top;\r\n    return extend({}, rect, {\r\n        width,\r\n        heigth,\r\n    });\r\n}\r\n\r\nexport const stringify = (obj) => {\r\n    let params = [];\r\n    for (let key in obj) {\r\n        params.push(`${key}=${obj[key]}`);\r\n    }\r\n    return params.join('&');\r\n}\r\n\r\nexport function getDomPath(element, useClass = false) {\r\n    if (!(element instanceof HTMLElement)) {\r\n        console.warn('input is not a HTML element!');\r\n        return '';\r\n    }\r\n    let domPath = [];\r\n    let elem = element;\r\n    while (elem) {\r\n        let domDesc = getDomDesc(elem, useClass);\r\n        if (!domDesc) {\r\n            break;\r\n        }\r\n        domPath.unshift(domDesc);\r\n        if (querySelector(domPath.join('>')) === element || domDesc.indexOf('body') >= 0) {\r\n            break;\r\n        }\r\n        domPath.shift();\r\n        const children = elem.parentNode.children;\r\n        if (children.length > 1) {\r\n            for (let i = 0; i < children.length; i++) {\r\n                if (children[i] === elem) {\r\n                    domDesc += `:nth-child(${i + 1})`;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        domPath.unshift(domDesc);\r\n        if (querySelector(domPath.join('>')) === element) {\r\n            break;\r\n        }\r\n        elem = elem.parentNode;\r\n    }\r\n    return domPath.join('>');\r\n}\r\n\r\nexport function getDomDesc(element, useClass = false) {\r\n    const domDesc = [];\r\n    if (!element || !element.tagName) {\r\n        return '';\r\n    }\r\n    if (element.id) {\r\n        return `#${element.id}`;\r\n    }\r\n    domDesc.push(element.tagName.toLowerCase());\r\n    if (useClass) {\r\n        const className = element.className;\r\n        if (className && typeof className === 'string') {\r\n            const classes = className.split(/\\s+/);\r\n            domDesc.push(`.${classes.join('.')}`);\r\n        }\r\n    }\r\n    if (element.name) {\r\n        domDesc.push(`[name=${element.name}]`);\r\n    }\r\n    return domDesc.join('');\r\n}\r\n\r\nexport function querySelector(queryString) {\r\n    return document.getElementById(queryString) || document.getElementsByName(queryString)[0] || document.querySelector(queryString);\r\n}\r\n","import extend from 'extend';\r\nimport {\r\n    getEvent,\r\n    getEventListenerMethod,\r\n    getBoundingClientRect,\r\n    stringify,\r\n    getDomPath,\r\n} from './utils'\r\n\r\nconst DefaultOptions = {\r\n    useClass: false,\r\n    per: 0.01,\r\n    events: ['click'],\r\n};\r\n\r\nclass Tracker {\r\n    constructor() {\r\n        this._isInstall = false;\r\n        this._options = {};\r\n    }\r\n\r\n    config(options = {}) {\r\n        options = extend(true, {}, DefaultOptions, options);\r\n        options.event = DefaultOptions.event;\r\n        this._options = options;\r\n        return this;\r\n    }\r\n\r\n    _captureEvents() {\r\n        const self = this;\r\n        const events = this._options.events;\r\n        const eventMethodObj = getEventListenerMethod();\r\n        for (let i = 0, j = events.length; i < j; i++) {\r\n            let eventName = events[i];\r\n            document.body[eventMethodObj.addMethod](eventMethodObj.prefix + eventName, function (event) {\r\n                const eventFix = getEvent(event);\r\n                if (!eventFix) {\r\n                    return;\r\n                }\r\n                self._handleEvent(eventFix);\r\n            }, false)\r\n        }\r\n    }\r\n\r\n    _handleEvent(event) {\r\n        const per = parseFloat(this._options.per);\r\n        if (!this.hit(per)) {\r\n            return;\r\n        }\r\n        const domPath = getDomPath(event.target, this._options.useClass);\r\n        const rect = getBoundingClientRect(event.target);\r\n        if (rect.width == 0 || rect.height == 0) {\r\n            return;\r\n        }\r\n        let t = document.documentElement || document.body.parentNode;\r\n        const scrollX = (t && typeof t.scrollLeft == 'number' ? t : document.body).scrollLeft;\r\n        const scrollY = (t && typeof t.scrollTop == 'number' ? t : document.body).scrollTop;\r\n        const pageX = event.pageX || event.clientX + scrollX;\r\n        const pageY = event.pageY || event.clientY + scrollY;\r\n        const data = {\r\n            domPath: encodeURIComponent(domPath),\r\n            trackingType: event.type,\r\n            offsetX: ((pageX - rect.left - scrollX) / rect.width).toFixed(6),\r\n            offsetY: ((pageY - rect.top - scrollY) / rect.height).toFixed(6),\r\n        };\r\n        this.send(data);\r\n    }\r\n\r\n    send(data = {}) {\r\n        console.log('data', data);\r\n        const image = new Image(1, 1);\r\n        image.onload = function () {\r\n            image = null;\r\n        };\r\n        image.src = `/?${stringify(data)}`;\r\n    }\r\n\r\n    hit(per = 0.01) {\r\n        return Math.random() < per;\r\n    }\r\n\r\n    install() {\r\n        if (this._isInstall) {\r\n            return this;\r\n        }\r\n        this._captureEvents();\r\n        this._isInstall = true;\r\n        return this;\r\n    }\r\n}\r\n\r\nexport default Tracker;","import Tracker from './tracker';\r\n\r\nconst tracker = new Tracker();\r\n\r\nexport default tracker;"],"names":["name","TypeError","instance","Constructor","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","isArray","arr","Array","toStr","call","isPlainObject","obj","hasOwnConstructor","hasOwn","hasIsPrototypeOf","constructor","prototype","setProperty","options","value","newValue","getProperty","gOPD","copy","copyIsArray","clone","arguments","deep","src","extend","protoProps","staticProps","hasOwnProperty","toString","getOwnPropertyDescriptor","getDomPath","element","useClass","HTMLElement","console","warn","domPath","elem","domDesc","tagName","id","classes","push","toLowerCase","className","split","join","getDomDesc","unshift","querySelector","indexOf","shift","children","parentNode","queryString","document","getElementById","getElementsByName","DefaultOptions","per","events","_isInstall","_options","event","this","addMethod","removeMethod","prefix","self","eventMethodObj","window","addEventListener","j","eventName","body","srcElement","currentTarget","eventFix","_handleEvent","scrollX","scrollY","pageX","data","parseFloat","hit","rect","getBoundingClientRect","width","right","left","heigth","bottom","top","height","t","documentElement","scrollLeft","scrollTop","clientX","pageY","clientY","encodeURIComponent","trackingType","type","offsetX","toFixed","offsetY","send","log","image","Image","onload","params","stringify","Math","random","_captureEvents"],"mappings":"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"}